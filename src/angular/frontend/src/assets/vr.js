!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.OVVR=t():e.OVVR=t()}(window,(function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){(function(t){let n,o,i,r,s,a,d,c,u,l,p,h,E,m,w,y=!1;const g=[];let f=[];const M=[],b=[];let T,R,H,x,v,S;const I=[];e.exports={OVVR:class{constructor(){for(let e=0;e<130;e++)I.push(!1)}initScene(){E=new THREE.Clock,c=new THREE.Vector2(0,0),d=window.innerWidth/window.innerHeight,r=new THREE.Scene,o=new THREE.PerspectiveCamera(50,d,1,1e9),o.position.set(800,800,0),o.lookAt(r.position),n=new THREE.WebGLRenderer({antialias:!0}),n.setClearColor(1842989),n.setSize(window.innerWidth,window.innerHeight),s=document.getElementById("viewport"),s.appendChild(n.domElement),h=new THREE.OrbitControls(o)}initLights(){a=new THREE.AmbientLight(16777215),r.add(a)}initGeometry(){let e;const t=new THREE.TextureLoader;i=t.load("resources/textures/wood.jpg"),i.wrapS=i.wrapT=THREE.RepeatWrapping,i.repeat.set(20,20),i.anisotropy=32;const n=new THREE.MeshBasicMaterial({map:i}),o=new THREE.PlaneGeometry(1500,1500,10,10),s=new THREE.Mesh(o,n);s.rotation.x=-Math.PI/2,r.add(s);for(let t=0;t<500;t++){const t=new THREE.MeshLambertMaterial({color:16777215}),n=15*Math.random()+3,o=new THREE.Mesh(new THREE.CubeGeometry(n,.1*n,.1*n),t);o.position.set(1e3*Math.random()-500,1e3*Math.random()+500,1e3*Math.random()-500),Math.random()>.5?(e=new THREE.Vector3(0,0,1.5*Math.random()+.5),o.rotation.y=Math.PI/2):e=new THREE.Vector3(1.5*Math.random()+.5,0,0),b.push({obj:o,speed:e}),r.add(o)}}generatePositionNumber(e,t,n){return Math.random()*(e-t)+t}createStudentBox(){Math.random();const e=generatePositionNumber(-500,500,380),t=-1e3*Math.random()+500;w.load("resources/models/Sitting.fbx",n=>{p=new THREE.AnimationMixer(n),p.clipAction(n.animations[0]).play(),n.position.set(e,0,t);n.rotation.set(0,.7079608503944332*Math.PI*2,0),n.height=2e3,n.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),g.push(n),r.add(n)})}removeStudentBox(){g.length>0&&(r.remove(g[g.length-1]),g.pop())}createTeacherBox(){console.log("CREATING TEACHER OBJECT");const e=new THREE.VideoTexture(u),t=new THREE.MeshLambertMaterial({map:e,side:THREE.DoubleSide,alphaTest:.5}),n=new THREE.Mesh(new THREE.CubeGeometry(0,300,380),t);n.position.set(-600,300/1.8,200),f.push(n),r.add(n)}createScreenBox(){const e=new THREE.VideoTexture(l),t=new THREE.MeshLambertMaterial({map:e,side:THREE.DoubleSide,alphaTest:.5}),n=new THREE.Mesh(new THREE.CubeGeometry(0,300,380),t);n.position.set(-600,300/1.8,-200),f.push(n),r.add(n)}removeTeacherBox(){f.forEach(e=>{f.pop(),r.remove(e)}),f=[]}init(e){t.document.addEventListener("keydown",this.onKeyDown,!1),t.document.addEventListener("keyup",this.onKeyUp,!1),t.document.addEventListener("mousedown",this.onMouseDown,!1),t.document.addEventListener("mousemove",this.onMouseMove,!1),t.document.getElementById("toggle-render").addEventListener("click",()=>{y=!y,this.onResize()}),window.document.getElementById("help").addEventListener("click",()=>{const e=document.getElementById("help-text");e.style.display="none"===e.style.display?"":"none"}),w=new THREE.FBXLoader,window.addEventListener("resize",this.onResize,!1),u=document.getElementById("video"),l=document.getElementById("videoScreenShare"),T=3.75,R=new THREE.Vector3(0,1,0),H=new THREE.Vector3(100,50,0),v=new THREE.Vector3,this.initScene(),this.initGeometry(),this.initLights(),"PUBLISHER"===e&&(this.createTeacherBox(),this.createScreenBox()),S=new OculusBridge({debug:!0,onOrientationUpdate:this.bridgeOrientationUpdated,onConfigUpdate:this.bridgeConfigUpdated,onConnect:this.bridgeConnected,onDisconnect:this.bridgeDisconnected}),S.connect(),m=new THREE.StereoEffect(n),m.setEyeSeparation(-1.8)}onResize(){y?m.setSize(window.innerWidth,window.innerHeight):(d=window.innerWidth/window.innerHeight,o.aspect=d,o.updateProjectionMatrix(),n.setSize(window.innerWidth,window.innerHeight))}bridgeConnected(){document.getElementById("logo").className=""}bridgeDisconnected(){document.getElementById("logo").className="offline"}bridgeConfigUpdated(e){console.log("Oculus config updated.")}bridgeOrientationUpdated(e){const t=new THREE.Quaternion;t.setFromAxisAngle(R,T);const n=new THREE.Quaternion(e.x,e.y,e.z,e.w);t.multiply(n);const i=new THREE.Vector3(0,0,1);i.applyQuaternion(t),x=Math.atan2(i.z,i.x)+Math.PI,o.quaternion.copy(t)}onMouseMove(e){c.set(2*(e.clientX/window.innerWidth-.5),2*(e.clientY/window.innerHeight-.5))}onMouseDown(e){i.needsUpdate=!0}onKeyDown(e){48===e.keyCode&&(y=!y,onResize()),I[32]||32!==e.keyCode||(v.y+=1.9),I[e.keyCode]=!0}onKeyUp(e){I[e.keyCode]=!1}updateInput(e){const t=50*e,n=55*e*Math.PI/180;(I[87]||I[38])&&(H.x+=Math.cos(x)*t,H.z+=Math.sin(x)*t),(I[83]||I[40])&&(H.x-=Math.cos(x)*t,H.z-=Math.sin(x)*t),I[81]&&(T+=n),I[69]&&(T-=n),(I[65]||I[37])&&(H.x-=Math.cos(x+Math.PI/2)*t,H.z-=Math.sin(x+Math.PI/2)*t),(I[68]||I[39])&&(H.x+=Math.cos(x+Math.PI/2)*t,H.z+=Math.sin(x+Math.PI/2)*t),v.y-=.15,H.y+=v.y,H.y<15&&(v.y*=-.12,H.y=15),y&&o.position.set(H.x,150,H.z)}animate(){const e=E.getDelta();p&&p.update(e),this.updateInput(e);for(let t=0;t<M.length;t++)M[t].rotation.x+=.25*e,M[t].rotation.y-=.33*e,M[t].rotation.z+=.1278*e;for(let e=0;e<b.length;e++)b[e].obj.position.add(b[e].speed),b[e].obj.position.x<-600?b[e].obj.position.x=600:b[e].obj.position.x>600&&(b[e].obj.position.x=-600),b[e].obj.position.z<-600?b[e].obj.position.z=600:b[e].obj.position.z>600&&(b[e].obj.position.z=-600);this.render()&&requestAnimationFrame(this.animate)}crashSecurity(e){S.disconnect(),document.getElementById("viewport").style.display="none",document.getElementById("security_error").style.display="block"}crashOther(e){S.disconnect(),document.getElementById("viewport").style.display="none",document.getElementById("generic_error").style.display="block",document.getElementById("exception_message").innerHTML=e.message}render(){try{y?m.render(r,o):(h.update(),n.render(r,o))}catch(e){return console.log(e),"SecurityError"===e.name?this.crashSecurity(e):this.crashOther(e),!1}return!0}}}}).call(this,n(2))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n}])}));